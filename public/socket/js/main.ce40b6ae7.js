!function(){"use strict";var e,t={6032:function(e,t,n){var r=n(8751),a=n(1017),c=n(7940),u=(n(1048),n(6341),n(1750),n(7213),n(2062),n(2831),n(4543),n(5852),n(6511),n(5148),n(9004),n(4860)),o=n.n(u),s=n(5271),i=n(9130),f=n(2349),l=n(5201),p=function(){return(0,f.Z)((function e(t,n){(0,i.Z)(this,e),(0,l.Z)(this,"time",new Date),this.code=t,this.message=n}),[{key:"setArrayBuffer",value:function(e){this.arrayBuffer=e}},{key:"setFileType",value:function(e){this.fileType=e}},{key:"getClassName",value:function(){return 0==this.code?"message-system":"message-user"}}])}(),d=(n(5556),"https:"==location.protocol?"wss":"ws"),v=location.host,y="".concat(d,"://").concat(v),h=["open","close","message","error"],m=function(e){var t=new WebSocket(y),n=h.map((function(t){return{eventType:t,callback:function(n){e({type:t,event:n})}}}));n.forEach((function(e){t.addEventListener(e.eventType,e.callback)}));return{ws:t,close:function(){n.forEach((function(e){t.removeEventListener(e.eventType,e.callback)})),t.close()}}},x=(n(4865),n(4343)),b=new TextEncoder,w=new TextDecoder,k=function(){var e=(0,a.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x._)(b.encode(t),JSON.stringify({type:"text"})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),g=function(){var e=(0,a.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=x._,e.next=3,t.arrayBuffer();case 3:return e.t1=e.sent,e.t2=JSON.stringify({type:"file",fileType:t.type,name:t.name}),e.abrupt("return",(0,e.t0)(e.t1,e.t2));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),j=function(){var e=(0,a.Z)(o().mark((function e(t){var n,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=x.x,e.next=3,t.arrayBuffer();case 3:if(e.t1=e.sent,n=(0,e.t0)(e.t1),"text"!=(r=JSON.parse(n.metadata)).type){e.next=8;break}return e.abrupt("return",{type:r.type,metadata:r,content:w.decode(n.arrayBuffer)});case 8:return e.abrupt("return",{type:r.type,metadata:r,content:n.arrayBuffer});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),T=n(2676),O=function(){var e=(0,s.useRef)(null),t=(0,s.useRef)(null),n=(0,s.useRef)(null),r=(0,s.useState)([]),u=(0,c.Z)(r,2),i=u[0],f=u[1],l=(0,s.useRef)(null),d=function(){var e=(0,a.Z)(o().mark((function e(){var n,r,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null===(n=t.current)||void 0===n?void 0:n.value){e.next=3;break}return e.abrupt("return");case 3:if(null!==(r=l.current)&&void 0!==r){e.next=7;break}e.next=12;break;case 7:return e.t0=r.ws,e.next=10,k(a);case 10:e.t1=e.sent,e.t0.send.call(e.t0,e.t1);case 12:t.current.value="";case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,s.useEffect)((function(){var e=0,t=!1,n=function(e){f((function(t){return t.concat(e)}))},r=function(){var c=(0,a.Z)(o().mark((function a(c){var u,s,i,f,d,v,y,h;return o().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(u=c.type,s=c.event,console.log("Socket ".concat(u),s),"open"!=u){a.next=8;break}t=!0,e=0,n(new p(0,"连接成功")),a.next=21;break;case 8:if("error"!=u){a.next=12;break}n(new p(0,t?"连接错误":"连接失败")),a.next=21;break;case 12:if("message"!=u){a.next=20;break}return i=s.data,a.next=16,j(i);case 16:"text"==(f=a.sent).type?n(new p(1,f.content)):"file"==f.type&&(d=f.metadata,v=d.fileType,y=d.name,(h=new p(2,"".concat(y))).setArrayBuffer(f.content),h.setFileType(v),n(h)),a.next=21;break;case 20:"close"==u&&((t=!1)&&n(new p(0,"连接已关闭")),setTimeout((function(){var e;n(new p(0,"正在重试中...")),null===(e=l.current)||void 0===e||e.close(),l.current=m(r)}),1e3*e++));case 21:case"end":return a.stop()}}),a)})));return function(e){return c.apply(this,arguments)}}();return l.current=m(r),function(){var e;null===(e=l.current)||void 0===e||e.close()}}),[]),(0,s.useLayoutEffect)((function(){if(0!=i.length){var t=e.current;t.clientHeight+t.scrollTop+60>t.scrollHeight&&t.scrollBy({top:Number.MAX_SAFE_INTEGER,behavior:"smooth"})}}),[i]),(0,T.jsxs)("div",{id:"app",children:[(0,T.jsx)("ul",{className:"messages",ref:e,children:i.map((function(e,t){return(0,T.jsxs)("li",{className:"message ".concat(e.getClassName()),children:[e.time.toLocaleTimeString(),":"," ",2==e.code?(0,T.jsx)(T.Fragment,{children:(0,T.jsx)("a",{href:URL.createObjectURL(new Blob([e.arrayBuffer],{type:e.fileType})),download:e.message,children:e.message})}):e.message]},t)}))}),(0,T.jsxs)("div",{className:"toolbar",children:[(0,T.jsx)("input",{type:"text",className:"input",ref:t,onKeyUp:function(e){"Enter"==e.key&&d()}}),(0,T.jsx)("input",{ref:n,type:"file",style:{display:"none"},value:"",onChange:function(){var e=(0,a.Z)(o().mark((function e(t){var n,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.target.files[0],null!==(n=l.current)&&void 0!==n){e.next=5;break}e.next=10;break;case 5:return e.t0=n.ws,e.next=8,g(r);case 8:e.t1=e.sent,e.t0.send.call(e.t0,e.t1);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),(0,T.jsx)("button",{className:"send-btn",onClick:d,children:"发送"}),(0,T.jsx)("button",{className:"send-btn",onClick:function(){var e;null===(e=n.current)||void 0===e||e.click()},children:"文件"})]})]})},E=document.createElement("div");(0,r.s)(E).render((0,T.jsx)(O,{})),document.body.appendChild(E)}},n={};function r(e){var a=n[e];if(void 0!==a)return a.exports;var c=n[e]={exports:{}};return t[e](c,c.exports,r),c.exports}r.m=t,e=[],r.O=function(t,n,a,c){if(!n){var u=1/0;for(f=0;f<e.length;f++){n=e[f][0],a=e[f][1],c=e[f][2];for(var o=!0,s=0;s<n.length;s++)(!1&c||u>=c)&&Object.keys(r.O).every((function(e){return r.O[e](n[s])}))?n.splice(s--,1):(o=!1,c<u&&(u=c));if(o){e.splice(f--,1);var i=a();void 0!==i&&(t=i)}}return t}c=c||0;for(var f=e.length;f>0&&e[f-1][2]>c;f--)e[f]=e[f-1];e[f]=[n,a,c]},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e={179:0};r.O.j=function(t){return 0===e[t]};var t=function(t,n){var a,c,u=n[0],o=n[1],s=n[2],i=0;if(u.some((function(t){return 0!==e[t]}))){for(a in o)r.o(o,a)&&(r.m[a]=o[a]);if(s)var f=s(r)}for(t&&t(n);i<u.length;i++)c=u[i],r.o(e,c)&&e[c]&&e[c][0](),e[c]=0;return r.O(f)},n=self.webpackChunkdemo=self.webpackChunkdemo||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var a=r.O(void 0,[216],(function(){return r(6032)}));a=r.O(a)}();